name: bayesdream
channels:
  - pytorch
  - conda-forge
  - bioconda
  - defaults

dependencies:
  # Python version
  - python=3.11

  # Core scientific computing
  - numpy>=1.24.0
  - scipy>=1.10.0
  - pandas>=2.0.0
  - scikit-learn>=1.3.0  # For spline transformations and Ridge regression

  # R and Bioconductor packages for preprocessing
  - r-base>=4.0
  - bioconductor-scran>=1.20
  - r-irkernel  # R kernel for Jupyter
  - r-data.table  # Fast data manipulation in R

  # PyTorch with GPU support (default)
  # Works with CUDA 12.x (compatible with most modern GPU clusters)
  - pytorch>=2.2.0
  - pytorch::pytorch-cuda=12.1

  # For CPU-only installation (e.g., local development without GPU):
  # Comment out the pytorch-cuda line above and uncomment this:
  # - pytorch::cpuonly

  # For older GPU clusters with CUDA 11.8:
  # Replace pytorch-cuda=12.1 with:
  # - pytorch::pytorch-cuda=11.8

  # Visualization (conda will select compatible versions)
  - matplotlib>=3.7
  - seaborn>=0.12

  # Pyro probabilistic programming (installed via pip to avoid conflicts)
  - pip
  - pip:
    - pyro-ppl>=1.9.0

  # Data I/O
  - h5py>=3.8.0

  # Optional but recommended for performance
  - openblas  # For optimized linear algebra operations

  # Jupyter for interactive notebooks
  - jupyterlab>=4.0
  - ipykernel  # Python kernel for Jupyter
  - notebook  # Classic Jupyter notebook
  - ipywidgets  # Interactive widgets for notebooks (fixes tqdm warning)

  # Development tools (optional)
  # Uncomment if needed:
  # - pytest
  # - pytest-cov
  # - black
  # - flake8

# Installation instructions:
# 1. Create the environment:
#    conda env create -f environment.yml
#
# 2. Activate the environment:
#    conda activate bayesdream
#
# 3. Install bayesDREAM in development mode:
#    cd /path/to/bayesDREAM_forClaude
#    pip install -e .
#
# GPU support (default):
# - The environment installs PyTorch with CUDA 12.1 support by default
# - This works with CUDA 12.x on most modern GPU clusters
# - For CPU-only installation, see the PyTorch section above
# - To check your cluster's CUDA version: nvcc --version or nvidia-smi
#
# Notes:
# - This environment includes R (>=4.0) and scran (>=1.20) from bioconda
# - JupyterLab and R kernel (IRkernel) are included for interactive analysis
# - Version constraints have been relaxed for better cross-platform compatibility
# - Uses Python 3.11 (better package compatibility than 3.12 on Linux)
# - PyTorch 2.2+ is recommended for best performance
# - Pyro 1.9+ is required for the probabilistic models
# - scran is used for calculating sum factors in preprocessing
#
# After installation, register the R kernel with Jupyter:
#   conda activate bayesdream
#   R -e "IRkernel::installspec(user = FALSE)"
#
# Troubleshooting:
# - If environment creation fails, try using mamba: conda install mamba -c conda-forge
#   Then: mamba env create -f environment.yml
# - For persistent conflicts, try creating with fewer channels:
#   Comment out the pytorch channel line and let conda-forge handle PyTorch
